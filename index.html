<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IRINDIRO FOOTBALL CLUB</title>
  <link rel="stylesheet" href="style.css">
  <!-- Supabase Client -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <header>
    <img src="images/profile.jpg" alt="Club Profile Picture">
    <h1>IRINDIRO FOOTBALL CLUB</h1>
  </header>

  <nav>
    <button onclick="openTab('about')">About</button>
    <button onclick="openTab('registration')">Registration</button>
    <button onclick="openTab('contributions')">Contributions</button>
  </nav>

  <div id="about" class="tab active">
    <h2>About IRINDIRO FC</h2>
    <p>Founded in 1980, Irindiro Football Club has grown into one of the strongest community clubs in the region...</p>
    
    <div class="gallery-container">
      <button class="gallery-btn prev" onclick="changeSlide(-1)">â€¹</button>
      <div class="gallery-wrapper">
        <div class="gallery-track" id="galleryTrack">
          <img src="images/squad1.jpg" alt="Squad Picture 1" class="gallery-slide">
          <img src="images/squad2.jpg" alt="Squad Picture 2" class="gallery-slide">
          <img src="images/squad3.jpg" alt="Squad Picture 3" class="gallery-slide">
          <img src="images/squad4.jpg" alt="Squad Picture 4" class="gallery-slide">
        </div>
      </div>
      <button class="gallery-btn next" onclick="changeSlide(1)">â€º</button>
    </div>
  </div>

  <div id="registration" class="tab">
    <h2>Player Registration</h2>
    <p>Enter player name and contribution:</p>
    <input type="text" id="playerName" placeholder="Player Name">
    <input type="number" id="playerAmount" placeholder="Amount">
    <button onclick="registerPlayer()">Register</button>

    <h3>Registered Players</h3>
    <table>
      <thead><tr><th>Player Name</th><th>Amount</th><th>Date</th></tr></thead>
      <tbody id="playerList"><tr><td colspan="3">Loading players...</td></tr></tbody>
    </table>
  </div>

  <div id="contributions" class="tab">
    <h2>Club Contributions</h2>
    <p>Enter contributor name and amount:</p>
    <input type="text" id="contribName" placeholder="Name">
    <input type="number" id="contribAmount" placeholder="Amount">
    <button onclick="addContribution()">Contribute</button>

    <div class="mpesa-details">
      <h3>Make Payment via M-Pesa</h3>
      <p><strong>Name:</strong> LAMAXON MUGURI</p>
      <p><strong>Number:</strong> <span id="mpesaNumber">0708884863</span>
        <button onclick="copyMpesaNumber()" class="copy-btn">Copy</button></p>
    </div>

    <h3>Contribution List</h3>
    <table>
      <thead><tr><th>Name</th><th>Amount</th><th>Date</th></tr></thead>
      <tbody id="contribList"><tr><td colspan="3">Loading contributions...</td></tr></tbody>
    </table>
    <h3>Total Contributions: <span id="total">0</span></h3>
  </div>

  <footer>Â© 2025 IRINDIRO FOOTBALL CLUB | Powered by Supabase</footer>

  <!-- ALL JAVASCRIPT INLINE - No external script.js needed -->
  <script>
    // Global Supabase Configuration
    const supabaseUrl = 'https://qguvmhnqorafjauogi.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFndXZtaG5xb3JhZmphdW9naSIsInJvbGUiOiJhbm9uIiwiaWF0IjoxNzI2NTYxMjAwLCJleHAiOjIwNDIxMzcyMDB9.ZzZ0W2X4Q5z1p3q8r7t9u0v2w3x4y5z6a7b8c9d0e1f2g3h4i5j6k7l8m9n0o1p2q3r4s5t6u7v8w9x0y1z2';
    
    // Initialize Supabase globally
    let supabase;
    try {
      supabase = supabase.createClient(supabaseUrl, supabaseKey);
      console.log('âœ… Supabase initialized successfully');
    } catch (error) {
      console.error('âŒ Supabase initialization failed:', error);
    }
    
    // GLOBAL FUNCTIONS - Available immediately for onclick
    function openTab(tabId) {
      console.log('ðŸ—‚ï¸ Switching to tab:', tabId);
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
      
      // Load data for specific tabs
      if (tabId === 'registration' && supabase) {
        loadPlayers();
      } else if (tabId === 'contributions' && supabase) {
        loadContributions();
      }
    }
    
    function registerPlayer() {
      if (!supabase) {
        alert('Database not ready. Please wait a moment and try again.');
        return;
      }
      
      console.log('âš½ Registering player...');
      const name = document.getElementById("playerName").value.trim();
      const amount = parseInt(document.getElementById("playerAmount").value);

      if (!name || isNaN(amount) || amount < 50) {
        alert("Enter valid name and amount (50 or greater).");
        return;
      }

      supabase
        .from('players')
        .insert([{ name, amount }])
        .then(({ error }) => {
          if (error) {
            console.error('Registration error:', error);
            alert('Error registering player: ' + error.message);
          } else {
            alert('Player registered successfully!');
            document.getElementById("playerName").value = "";
            document.getElementById("playerAmount").value = "";
            loadPlayers();
          }
        })
        .catch(error => {
          console.error('Registration error:', error);
          alert('Error registering player: ' + error.message);
        });
    }
    
    function addContribution() {
      if (!supabase) {
        alert('Database not ready. Please wait a moment and try again.');
        return;
      }
      
      console.log('ðŸ’° Adding contribution...');
      const name = document.getElementById("contribName").value.trim();
      const amount = parseInt(document.getElementById("contribAmount").value);

      if (!name || isNaN(amount) || amount < 20) {
        alert("Enter valid name and amount (20 or more).");
        return;
      }

      supabase
        .from('contributions')
        .insert([{ name, amount }])
        .then(({ error }) => {
          if (error) {
            console.error('Contribution error:', error);
            alert('Error adding contribution: ' + error.message);
          } else {
            alert('Contribution added successfully!');
            document.getElementById("contribName").value = "";
            document.getElementById("contribAmount").value = "";
            loadContributions();
          }
        })
        .catch(error => {
          console.error('Contribution error:', error);
          alert('Error adding contribution: ' + error.message);
        });
    }
    
    function copyMpesaNumber() {
      console.log('ðŸ“‹ Copying M-Pesa number...');
      const number = document.getElementById("mpesaNumber").textContent;
      navigator.clipboard.writeText(number).then(() => {
        alert("M-Pesa number copied to clipboard!");
      }).catch(() => {
        alert("Failed to copy. Please copy manually: 0708884863");
      });
    }
    
    // Gallery Functions
    let currentSlide = 0;
    const slidesCount = 4;
    
    function changeSlide(direction) {
      currentSlide += direction;
      if (currentSlide >= slidesCount) currentSlide = 0;
      if (currentSlide < 0) currentSlide = slidesCount - 1;
      const track = document.getElementById('galleryTrack');
      if (track) {
        track.style.transform = `translateX(-${currentSlide * 25}%)`;
      }
    }
    
    // Load Players
    function loadPlayers() {
      if (!supabase) {
        console.log('â³ Supabase not ready, skipping loadPlayers');
        return;
      }
      
      console.log('ðŸ“¥ Loading players...');
      supabase
        .from('players')
        .select('*')
        .order('created_at', { ascending: false })
        .then(({ data: players, error }) => {
          const tbody = document.getElementById("playerList");
          
          if (error) {
            console.error('Load players error:', error);
            tbody.innerHTML = '<tr><td colspan="3">Error loading players.</td></tr>';
            return;
          }
          
          if (players && players.length > 0) {
            tbody.innerHTML = players.map(player => `
              <tr>
                <td>${player.name}</td>
                <td>${player.amount}</td>
                <td>${new Date(player.created_at).toLocaleDateString()}</td>
              </tr>
            `).join('');
            console.log('âœ… Loaded', players.length, 'players');
          } else {
            tbody.innerHTML = '<tr><td colspan="3">No players registered yet.</td></tr>';
          }
        })
        .catch(error => {
          console.error('Load players error:', error);
          document.getElementById("playerList").innerHTML = '<tr><td colspan="3">Error loading players.</td></tr>';
        });
    }
    
    // Load Contributions
    function loadContributions() {
      if (!supabase) {
        console.log('â³ Supabase not ready, skipping loadContributions');
        return;
      }
      
      console.log('ðŸ“¥ Loading contributions...');
      supabase
        .from('contributions')
        .select('*')
        .order('created_at', { ascending: false })
        .then(({ data: contributions, error }) => {
          const tbody = document.getElementById("contribList");
          let total = 0;
          
          if (error) {
            console.error('Load contributions error:', error);
            tbody.innerHTML = '<tr><td colspan="3">Error loading contributions.</td></tr>';
            document.getElementById("total").textContent = 'Error';
            return;
          }
          
          if (contributions && contributions.length > 0) {
            tbody.innerHTML = contributions.map(contrib => {
              total += contrib.amount;
              return `
                <tr>
                  <td>${contrib.name}</td>
                  <td>${contrib.amount}</td>
                  <td>${new Date(contrib.created_at).toLocaleDateString()}</td>
                </tr>
              `;
            }).join('');
            document.getElementById("total").textContent = total;
            console.log('âœ… Loaded', contributions.length, 'contributions, total:', total);
          } else {
            tbody.innerHTML = '<tr><td colspan="3">No contributions yet.</td></tr>';
            document.getElementById("total").textContent = 0;
          }
        })
        .catch(error => {
          console.error('Load contributions error:', error);
          document.getElementById("contribList").innerHTML = '<tr><td colspan="3">Error loading contributions.</td></tr>';
          document.getElementById("total").textContent = 'Error';
        });
    }
    
    // Initialize everything when page loads
    document.addEventListener('DOMContentLoaded', function() {
      console.log('ðŸ“„ Page loaded - initializing Irindiro FC app');
      console.log('ðŸ”— Supabase status:', supabase ? 'Ready' : 'Not ready');
      
      // Load initial data after a short delay
      setTimeout(() => {
        if (supabase) {
          loadContributions();
          loadPlayers();
        } else {
          console.warn('âš ï¸ Supabase not ready - will try again in 2 seconds');
          setTimeout(() => {
            loadContributions();
            loadPlayers();
          }, 2000);
        }
      }, 1000);
      
      // Gallery touch events
      let startX = 0, endX = 0;
      const wrapper = document.querySelector('.gallery-wrapper');
      if (wrapper) {
        wrapper.addEventListener('touchstart', e => startX = e.touches[0].clientX);
        wrapper.addEventListener('touchmove', e => e.preventDefault());
        wrapper.addEventListener('touchend', e => {
          endX = e.changedTouches[0].clientX;
          const diff = startX - endX;
          if (Math.abs(diff) > 50) {
            changeSlide(diff > 0 ? 1 : -1);
          }
        });
      }
      
      console.log('ðŸš€ Irindiro FC app ready!');
    });
  </script>
</body>
</html>
