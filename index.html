<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Irindiro Football Club</title>
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Poppins', sans-serif;
      margin: 0; padding: 0;
      background: linear-gradient(to right, #f0f4ff, #e6f0fa);
      color: #333;
      display: flex; flex-direction: column; min-height: 100vh; overflow-x: hidden;
    }
    header { background: linear-gradient(90deg, #0052d4, #4364f7, #6fb1fc); color: white; padding: 25px 15px; text-align: center; position: relative; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
    #profile-container { position: relative; display: inline-block; }
    #profile-pic { width: 95px; height: 95px; border-radius: 50%; border: 3px solid #fff; margin: 0 auto 8px; display: block; background-color: #ddd; }
    #edit-pic { position: absolute; bottom: 12px; right: 12px; background: #ffb703; color: black; border-radius: 50%; padding: 5px; cursor: pointer; font-size: 13px; box-shadow: 0 2px 6px rgba(0,0,0,0.3); }
    h1 { margin: 5px 0; font-size: 24px; }
    #mission { font-size: 14px; margin-top: 5px; font-style: italic; opacity: 0.9; }
    nav { display: flex; justify-content: center; flex-wrap: wrap; background: #222; padding: 10px 5px; }
    nav button { flex: 1; min-width: 100px; background: #0052d4; color: white; border: none; padding: 10px 12px; margin: 5px; cursor: pointer; border-radius: 20px; font-size: 14px; transition: 0.3s; }
    nav button:hover { background: #003c9e; }
    nav button.active { background: #ffb703; color: #222; font-weight: bold; }
    section { display: none; padding: 15px; max-width: 850px; margin: 15px auto; background: #fff; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); width: 95%; }
    section.active { display: block; }
    h2 { color: #0052d4; margin-bottom: 12px; font-size: 20px; }
    form { display: flex; flex-wrap: wrap; gap: 10px; background: #f9f9f9; padding: 15px; border-radius: 8px; margin-bottom: 15px; box-shadow: inset 0 1px 3px rgba(0,0,0,0.1); }
    input, button { padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px; flex: 1; min-width: 120px; }
    button { background-color: #28a745; color: white; cursor: pointer; border: none; transition: 0.3s; }
    button:hover { background-color: #1e7e34; }
    .player-item { background: #fdfdfd; margin: 6px 0; padding: 8px 12px; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid #0052d4; font-size: 14px; }
    .registered { color: green; font-weight: bold; }
    #contributions-table { width: 100%; border-collapse: collapse; margin-top: 10px; border-radius: 8px; overflow: hidden; font-size: 14px; }
    #contributions-table th, #contributions-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    #contributions-table th { background: #0052d4; color: white; }
    .paid { color: green; font-weight: bold; }
    #total-row td { font-weight: bold; background: #f1f1f1; }
    .payment-info { margin-top: 15px; padding: 12px; background: #f9f9f9; border: 1px solid #ccc; border-radius: 8px; font-size: 14px; word-break: break-word; }
    .payment-info strong { color: #0052d4; }
    .copy-btn { background: #0052d4; color: #fff; border: none; padding: 6px 10px; border-radius: 5px; cursor: pointer; font-size: 13px; margin-top: 6px; }
    .copy-btn:hover { background: #003c9e; }
    #whatsapp-btn { position: fixed; bottom: 70px; right: 15px; background: #25D366; color: white; border: none; padding: 10px 15px; border-radius: 50px; cursor: pointer; font-size: 14px; font-weight: bold; box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 1000; display: flex; align-items: center; gap: 6px; }
    #whatsapp-btn img { width: 20px; height: 20px; }
    footer { background: #222; color: white; text-align: center; padding: 10px; width: 100%; margin-top: auto; font-size: 13px; }
    @media (max-width: 600px) {
      nav button { font-size: 13px; padding: 8px; }
      h1 { font-size: 20px; }
      h2 { font-size: 18px; }
      input, button { flex: 100%; min-width: unset; }
      .player-item { font-size: 13px; padding: 7px 10px; }
      #contributions-table th, #contributions-table td { font-size: 12px; padding: 6px; }
    }
  </style>
</head>
<body>
  <header>
    <div id="profile-container">
      <img id="profile-pic" src="placeholder-profile.jpg" alt="Club Profile Picture">
      <span id="edit-pic">‚úèÔ∏è</span>
    </div>
    <h1>Irindiro Football Club</h1>
    <p id="mission">To provide quality talents throughout the society.</p>
  </header>

  <nav>
    <button onclick="showTab('registration')" class="active">Registration</button>
    <button onclick="showTab('players')">Players</button>
    <button onclick="showTab('contributions')">Contributions</button>
  </nav>

  <section id="registration" class="active">
    <h2>Player Registration</h2>
    <form onsubmit="registerPlayer(event)">
      <input type="text" id="playerName" placeholder="Enter Player Name" required>
      <input type="number" id="amount" placeholder="Enter Amount (KES)" min="50" required>
      <button type="submit">Register</button>
    </form>
    <p id="regMessage"></p>
  </section>

  <section id="players">
    <h2>Players</h2>
    <div class="category">
      <h3>All Players</h3>
      <ul class="player-list" id="all-players"></ul>
    </div>
    <button onclick="addNewPlayer()" style="background:#0052d4;color:white;">‚ûï Add Player</button>
  </section>

  <section id="contributions">
    <h2>Contributions</h2>
    <form onsubmit="addContribution(event)">
      <input type="text" id="contribName" placeholder="Player Name" required>
      <input type="number" id="contribAmount" placeholder="Contribution Amount (KES)" required>
      <button type="submit">Add Contribution</button>
    </form>
    <button onclick="resetContributions()" style="background-color:red;color:white;">Reset Contributions</button>
    <table id="contributions-table">
      <thead>
        <tr>
          <th>#</th>
          <th>Name</th>
          <th>Contribution</th>
          <th>Total</th>
          <th>Paid</th>
        </tr>
      </thead>
      <tbody id="contrib-body"></tbody>
      <tfoot>
        <tr id="total-row">
          <td colspan="2">Total Contributions</td>
          <td id="total-contrib">0</td>
          <td id="total-all">0</td>
          <td></td>
        </tr>
      </tfoot>
    </table>

    <!-- Payment Info -->
    <div class="payment-info">
      <p><strong>Payment Details:</strong></p>
      <p>Name: <strong>LAMAXON MUGURI</strong></p>
      <p>Number: <span id="payNumber">0708884863</span></p>
      <button class="copy-btn" onclick="copyNumber()">üìã Copy Number</button>
    </div>
  </section>

  <button id="whatsapp-btn" onclick="joinWhatsApp()" title="Join WhatsApp Group">
    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp">
    WhatsApp Group
  </button>

  <footer>
    <p>&copy; 2025 Irindiro Football Club. Developed by Colloh.</p>
  </footer>

  <script>
    // 1. Initialize Firebase (with your actual config)
    const firebaseConfig = {
      apiKey: "AIzaSyD0dTsQ91pdMFLoEpiF3R30kQWSqCe8waY",
      authDomain: "irindiro-fc.firebaseapp.com",
      projectId: "irindiro-fc",
      storageBucket: "irindiro-fc.appspot.com",
      messagingSenderId: "1000246890929",
      appId: "1:1000246890929:web:28b601589c1347ed466d90"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // 2. Tab switching
    function showTab(tabName) {
      document.querySelectorAll('section').forEach(sec => sec.classList.remove('active'));
      document.querySelectorAll('nav button').forEach(btn => btn.classList.remove('active'));
      document.getElementById(tabName).classList.add('active');
      event.target.classList.add('active');
      if (tabName === 'players') renderPlayers();
      if (tabName === 'contributions') renderContributions();
      if (tabName === 'registration') renderPlayersForRegistration();
    }

    // 3. Registration in Firestore
    function registerPlayer(event) {
      event.preventDefault();
      const name = document.getElementById('playerName').value.trim().toUpperCase();
      const amount = parseInt(document.getElementById('amount').value);

      if (amount < 50) {
        document.getElementById('regMessage').textContent = 'Amount must be KES 50 or above!';
        return;
      }
      if (!name) return;

      // Store registration in "registrations" collection using player name as id
      db.collection("registrations").doc(name).set({
        name,
        amount,
        registered: true,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      }).then(() => {
        document.getElementById('regMessage').textContent = `${name} registered successfully!`;
        document.getElementById('playerName').value = '';
        document.getElementById('amount').value = '';
        setTimeout(() => document.getElementById('regMessage').textContent = '', 3000);
        renderPlayers(); // update registration ticks
      });
    }

    // 4. Render players from Firestore (real-time sync)
    function renderPlayers() {
      const ul = document.getElementById('all-players');
      ul.innerHTML = '';
      db.collection("players").orderBy("name").onSnapshot(playerSnap => {
        db.collection("registrations").get().then(regSnap => {
          const registeredMap = {};
          regSnap.forEach(doc => registeredMap[doc.id] = doc.data().registered);

          ul.innerHTML = '';
          let i = 1;
          playerSnap.forEach(doc => {
            const name = doc.data().name;
            const li = document.createElement('li');
            li.className = 'player-item';
            li.innerHTML = `
              <span>${i++}. ${name}</span>
              <span class="${registeredMap[name] ? 'registered' : ''}">‚úì</span>
            `;
            ul.appendChild(li);
          });
        });
      });
    }

    // 5. Render players for registration autocomplete (optional for improvement)
    function renderPlayersForRegistration() {
      // Could be used to add autocomplete or listing for registration form
    }

    // 6. Add new player to Firestore
    function addNewPlayer() {
      const newName = prompt("Enter new player's name:");
      if (newName) {
        db.collection("players").add({
          name: newName.trim().toUpperCase()
        });
      }
    }

    // 7. Add contribution to Firestore
    function addContribution(event) {
      event.preventDefault();
      const name = document.getElementById('contribName').value.trim().toUpperCase();
      const amount = parseInt(document.getElementById('contribAmount').value);

      if (!name || isNaN(amount) || amount < 1) return;

      const contribDoc = db.collection("contributions").doc(name);
      contribDoc.get().then(docSnapshot => {
        if (docSnapshot.exists) {
          const data = docSnapshot.data();
          contribDoc.update({
            contrib: (data.contrib || 0) + amount,
            total: (data.total || 0) + amount,
            paid: true,
            paidAmount: amount
          });
        } else {
          contribDoc.set({
            name,
            contrib: amount,
            total: amount,
            paid: true,
            paidAmount: amount
          });
        }
        document.getElementById('contribName').value = '';
        document.getElementById('contribAmount').value = '';
      });
    }

    // 8. Render contributions from Firestore (real-time)
    function renderContributions() {
      const tbody = document.getElementById('contrib-body');
      tbody.innerHTML = '';
      db.collection("contributions").orderBy("name").onSnapshot(snapshot => {
        let totalContrib = 0;
        let totalAll = 0;
        tbody.innerHTML = '';
        let index = 1;
        snapshot.forEach(doc => {
          const c = doc.data();
          totalContrib += c.contrib || 0;
          totalAll += c.total || 0;
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${index++}</td>
            <td>${c.name}</td>
            <td>${c.contrib || 0}</td>
            <td>${c.total || 0}</td>
            <td class="${c.paid ? 'paid' : ''}">${c.paid ? '‚úÖ' : 'No'}</td>
          `;
          tbody.appendChild(tr);
        });
        document.getElementById('total-contrib').textContent = totalContrib;
        document.getElementById('total-all').textContent = totalAll;
      });
    }

    // 9. Reset all contributions in Firestore
    function resetContributions() {
      if (confirm("Are you sure you want to reset all contributions?")) {
        db.collection("contributions").get().then(snapshot => {
          const batch = db.batch();
          snapshot.forEach(doc => batch.delete(doc.ref));
          batch.commit().then(renderContributions);
        });
      }
    }

    function copyNumber() {
      const number = document.getElementById('payNumber').textContent;
      navigator.clipboard.writeText(number).then(() => {
        alert("Number copied: " + number);
      });
    }
    function joinWhatsApp() {
      window.open('https://chat.whatsapp.com/Foof1HTeEWBBJJCU6nSVEM', '_blank');
    }
    document.getElementById('edit-pic').addEventListener('click', () => {
      alert("Feature to upload/change profile picture coming soon!");
    });

    // 10. Initial render
    renderPlayers();
    renderContributions();
  </script>
</body>
</html>
