<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Irindiro Football Club</title>
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <!-- Font Awesome for Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * { box-sizing: border-box; }
    body { font-family: 'Poppins', sans-serif; font-weight: 400; line-height: 1.6; margin: 0; padding: 0;
      background: linear-gradient(to right, #f0f4ff, #e6f0fa); color: #333;
      display: flex; flex-direction: column; min-height: 100vh; overflow-x: hidden; }
    header { background: linear-gradient(90deg, #004080, #0052d4, #1e40af); color: white; padding: 25px 15px; text-align: center; position: relative; box-shadow: 0 4px 8px rgba(0,0,0,0.2); }
    #profile-container { position: relative; display: inline-block; }
    #profile-pic { width: 95px; height: 95px; border-radius: 50%; border: 3px solid #fff; margin: 0 auto 8px; display: block; background-color: #ddd; }
    #edit-pic { position: absolute; bottom: 12px; right: 12px; background: #10b981; color: white; border-radius: 50%; padding: 5px; cursor: pointer; font-size: 13px; box-shadow: 0 2px 6px rgba(0,0,0,0.3); }
    h1 { margin: 8px 0; font-size: 28px; font-weight: 600; }
    #mission { font-size: 15px; font-weight: 300; margin-top: 5px; font-style: italic; opacity: 0.95; }
    nav { display: flex; justify-content: center; flex-wrap: wrap; background: #222; padding: 10px 5px; }
    nav button { flex: 1; min-width: 100px; background: #1e40af; color: white; border: none; padding: 10px 12px; margin: 5px; cursor: pointer; border-radius: 20px; font-size: 14px; transition: all 0.2s ease; transform: translateY(0); }
    nav button:hover { background: #1e3a8a; transform: translateY(-1px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
    nav button.active { background: #10b981; color: white; font-weight: bold; }
    section { display: none; padding: 25px; max-width: 900px; margin: 20px auto; background: #fff; border-radius: 12px; box-shadow: 0 6px 20px rgba(0,0,0,0.08); width: 95%; }
    section.active { display: block; }
    h2 { color: #1e40af; margin-bottom: 16px; font-size: 22px; font-weight: 500; }
    h3 { font-size: 18px; font-weight: 500; color: #374151; margin-bottom: 12px; }
    form { display: flex; flex-wrap: wrap; gap: 15px; background: #f9f9f9; padding: 20px; border-radius: 8px; margin-bottom: 15px; box-shadow: inset 0 1px 3px rgba(0,0,0,0.1); }
    input, button { padding: 12px; border: 1px solid #ccc; border-radius: 6px; font-size: 15px; flex: 1; min-width: 120px; }
    button { background-color: #28a745; color: white; cursor: pointer; border: none; transition: all 0.2s ease; transform: translateY(0); }
    button:hover { background-color: #1e7e34; transform: translateY(-1px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
    .player-item { background: #fdfdfd; margin: 10px 0; padding: 12px 16px; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid #10b981; font-size: 14px; font-weight: 400; line-height: 1.5; gap: 12px; }
    .player-item.deleting { animation: fadeOut 0.5s ease forwards; }
    @keyframes fadeOut { to { opacity: 0; transform: translateY(10px); } }
    .registered { color: green; font-weight: bold; }
    /* Dropdown Styles */
    .dropdown-container { position: relative; display: inline-block; margin-top: 10px; }
    #delete-players-dropdown { padding: 12px; border: 1px solid #ccc; border-radius: 6px; font-size: 15px; background: #fff; cursor: pointer; width: 200px; }
    #delete-players-dropdown:focus { outline: none; border-color: #1e40af; }
    #delete-players-dropdown option { padding: 10px; }
    .dropdown-container button { background: #dc2626; color: white; margin-left: 10px; padding: 12px 16px; display: inline-flex; align-items: center; gap: 4px; }
    .dropdown-container button:hover { background: #b91c1c; }
    #contributions-table { width: 100%; border-collapse: collapse; margin-top: 10px; border-radius: 8px; overflow: hidden; font-size: 14px; }
    #contributions-table th, #contributions-table td { border: 1px solid #ddd; padding: 12px 10px; text-align: left; font-weight: 400; line-height: 1.5; }
    #contributions-table th { background: #1e40af; color: white; }
    .paid { color: green; font-weight: bold; }
    #total-row td { font-weight: bold; background: #f1f1f1; }
    .payment-info { margin-top: 20px; padding: 16px; background: #f9f9f9; border: 1px solid #ccc; border-radius: 8px; font-size: 14px; word-break: break-word; }
    .payment-info strong { color: #1e40af; }
    .copy-btn { background: #1e40af; color: #fff; border: none; padding: 6px 10px; border-radius: 6px; cursor: pointer; font-size: 13px; margin-top: 6px; transition: all 0.2s ease; transform: translateY(0); }
    .copy-btn:hover { background: #1e3a8a; transform: translateY(-1px); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
    #whatsapp-btn { position: fixed; bottom: 70px; right: 15px; background: #25D366; color: white; border: none; padding: 10px 15px; border-radius: 50px; cursor: pointer; font-size: 14px; font-weight: bold; box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 1000; display: flex; align-items: center; gap: 6px; transition: all 0.2s ease; transform: translateY(0); }
    #whatsapp-btn:hover { transform: translateY(-1px); box-shadow: 0 6px 16px rgba(0,0,0,0.3); }
    #whatsapp-btn img { width: 20px; height: 20px; }
    /* Login Section */
    #login-section { display: flex; justify-content: center; align-items: center; height: 100vh; }
    #login-section form { background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 6px 20px rgba(0,0,0,0.08); width: 100%; max-width: 400px; }
    #login-section input { margin-bottom: 15px; }
    #login-section button { width: 100%; }
    #auth-error { color: red; font-size: 14px; text-align: center; }
    /* Modal Styles */
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000; justify-content: center; align-items: center; }
    .modal-content { background: #fff; border-radius: 12px; padding: 20px; max-width: 400px; width: 90%; text-align: center; box-shadow: 0 6px 20px rgba(0,0,0,0.2); animation: slideIn 0.3s ease; }
    @keyframes slideIn { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    .modal-content h3 { font-size: 20px; color: #1e40af; margin-bottom: 15px; }
    .modal-content p { font-size: 15px; color: #374151; margin-bottom: 20px; }
    .modal-buttons { display: flex; gap: 10px; justify-content: center; }
    .modal-btn { padding: 10px 20px; border-radius: 6px; font-size: 14px; cursor: pointer; transition: all 0.2s ease; transform: translateY(0); }
    .modal-btn.cancel { background: #e5e7eb; color: #374151; }
    .modal-btn.cancel:hover { background: #d1d5db; transform: translateY(-1px); }
    .modal-btn.confirm { background: #dc2626; color: white; }
    .modal-btn.confirm:hover { background: #b91c1c; transform: translateY(-1px); }
    footer { background: #222; color: white; text-align: center; padding: 15px; width: 100%; margin-top: auto; font-size: 13px; font-weight: 300; }
    @media (max-width: 600px) {
      nav button { font-size: 13px; padding: 8px; }
      h1 { font-size: 20px; }
      h2 { font-size: 18px; }
      input, button { flex: 100%; min-width: unset; }
      .player-item { font-size: 13px; padding: 7px 10px; }
      #contributions-table th, #contributions-table td { font-size: 12px; padding: 6px; }
      section { padding: 20px 15px; }
      .dropdown-container { width: 100%; }
      #delete-players-dropdown { width: 100%; }
      .dropdown-container button { margin-left: 0; margin-top: 10px; width: 100%; }
      .modal-content { padding: 15px; }
      .modal-btn { padding: 8px 16px; font-size: 13px; }
      #login-section form { width: 90%; }
    }
  </style>
</head>
<body>
  <section id="login-section">
    <form id="login-form">
      <h2>Login to Irindiro FC</h2>
      <input type="email" id="email" placeholder="Enter Email" required>
      <input type="password" id="password" placeholder="Enter Password" required>
      <button type="submit">Login</button>
      <p id="auth-error"></p>
    </form>
  </section>

  <header id="main-header" style="display: none;">
    <div id="profile-container">
      <img id="profile-pic" src="placeholder-profile.jpg" alt="Club Profile Picture">
      <span id="edit-pic">✏️</span>
    </div>
    <h1>Irindiro Football Club</h1>
    <p id="mission">To provide quality talents throughout the society.</p>
  </header>

  <nav id="main-nav" style="display: none;">
    <button onclick="showTab('registration', this)" class="active">Registration</button>
    <button onclick="showTab('players', this)">Players</button>
    <button onclick="showTab('contributions', this)">Contributions</button>
  </nav>

  <section id="registration">
    <h2>Player Registration</h2>
    <form onsubmit="registerPlayer(event)">
      <input type="text" id="playerName" placeholder="Enter Player Name" required>
      <input type="number" id="amount" placeholder="Enter Amount (KES)" min="50" required>
      <button type="submit">Register</button>
    </form>
    <p id="regMessage"></p>
  </section>

  <section id="players">
    <h2>Players</h2>
    <div class="category">
      <h3>All Players</h3>
      <ul class="player-list" id="all-players"></ul>
    </div>
    <button onclick="addNewPlayer()" style="background:#1e40af;color:white;"><i class="fas fa-plus"></i> Add Player</button>
    <button onclick="showResetModal()" style="background:#dc2626;color:white;"><i class="fas fa-trash"></i> Reset Players</button>
    <div class="dropdown-container">
      <select id="delete-players-dropdown" multiple>
        <option value="" disabled>Select players to delete</option>
      </select>
      <button onclick="showDeleteModal()"><i class="fas fa-trash"></i> Delete Selected</button>
    </div>
  </section>

  <section id="contributions">
    <h2>Contributions</h2>
    <form onsubmit="addContribution(event)">
      <input type="text" id="contribName" placeholder="Player Name" required>
      <input type="number" id="contribAmount" placeholder="Contribution Amount (KES)" required>
      <button type="submit">Add Contribution</button>
    </form>
    <button onclick="resetContributions()" style="background-color:#dc2626;color:white;"><i class="fas fa-trash"></i> Reset Contributions</button>
    <table id="contributions-table">
      <thead>
        <tr>
          <th>#</th>
          <th>Name</th>
          <th>Contribution</th>
          <th>Total</th>
          <th>Paid</th>
        </tr>
      </thead>
      <tbody id="contrib-body"></tbody>
      <tfoot>
        <tr id="total-row">
          <td colspan="2">Total Contributions</td>
          <td id="total-contrib">0</td>
          <td id="total-all">0</td>
          <td></td>
        </tr>
      </tfoot>
    </table>

    <div class="payment-info">
      <p><strong>Payment Details:</strong></p>
      <p>Name: <strong>LAMAXON MUGURI</strong></p>
      <p>Number: <span id="payNumber">0708884863</span></p>
      <button class="copy-btn" onclick="copyNumber()">📋 Copy Number</button>
    </div>
  </section>

  <button id="whatsapp-btn" onclick="joinWhatsApp()" title="Join WhatsApp Group">
    <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/WhatsApp.svg" alt="WhatsApp">
    WhatsApp Group
  </button>

  <!-- Delete Confirmation Modal -->
  <div id="delete-modal" class="modal">
    <div class="modal-content">
      <h3>Confirm Deletion</h3>
      <p id="modal-message">Are you sure?</p>
      <div class="modal-buttons">
        <button class="modal-btn cancel" onclick="closeModal()">Cancel</button>
        <button class="modal-btn confirm" id="confirm-delete">Delete</button>
      </div>
    </div>
  </div>

  <footer id="main-footer" style="display: none;">
    <p>&copy; <span id="year">2025</span> Irindiro Football Club. Developed by Colloh.</p>
  </footer>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyD0dTsQ91pdMFLoEpiF3R30kQWSqCe8waY",
      authDomain: "irindiro-fc.firebaseapp.com",
      projectId: "irindiro-fc",
      storageBucket: "irindiro-fc.appspot.com",
      messagingSenderId: "1000246890929",
      appId: "1:1000246890929:web:28b601589c1347ed466d90"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    // Authentication
    function showMainContent() {
      document.getElementById('login-section').style.display = 'none';
      document.getElementById('main-header').style.display = 'block';
      document.getElementById('main-nav').style.display = 'flex';
      document.getElementById('main-footer').style.display = 'block';
      document.getElementById('registration').classList.add('active');
      renderPlayers();
      renderContributions();
    }

    auth.onAuthStateChanged(user => {
      if (user) {
        showMainContent();
      } else {
        document.getElementById('login-section').style.display = 'flex';
        document.getElementById('main-header').style.display = 'none';
        document.getElementById('main-nav').style.display = 'none';
        document.getElementById('main-footer').style.display = 'none';
        document.querySelectorAll('section').forEach(sec => sec.classList.remove('active'));
      }
    });

    document.getElementById('login-form').addEventListener('submit', event => {
      event.preventDefault();
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      auth.signInWithEmailAndPassword(email, password).then(() => {
        document.getElementById('auth-error').textContent = '';
      }).catch(err => {
        document.getElementById('auth-error').textContent = err.message;
      });
    });

    function showTab(tabName, el) {
      document.querySelectorAll('section').forEach(sec => sec.classList.remove('active'));
      document.querySelectorAll('nav button').forEach(btn => btn.classList.remove('active'));
      document.getElementById(tabName).classList.add('active');
      if (el) el.classList.add('active');
      if (tabName === 'players') renderPlayers();
      if (tabName === 'contributions') renderContributions();
    }

    // Register player
    function registerPlayer(event) {
      event.preventDefault();
      const name = document.getElementById('playerName').value.trim().toUpperCase();
      const amount = parseInt(document.getElementById('amount').value);
      if (amount < 50) {
        document.getElementById('regMessage').textContent = 'Amount must be KES 50 or above!';
        return;
      }
      if (!name) return;

      db.collection("registrations").add({
        name,
        amount,
        registered: true,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      }).then(() => {
        db.collection("players").where("name", "==", name).get().then(snap => {
          if (snap.empty) db.collection("players").add({ name });
        });
        document.getElementById('regMessage').textContent = `${name} registered successfully!`;
        document.getElementById('playerName').value = '';
        document.getElementById('amount').value = '';
        setTimeout(() => document.getElementById('regMessage').textContent = '', 3000);
        renderPlayers();
      }).catch(err => {
        console.error("Registration failed:", err);
        alert("Error saving to Firestore. Check your rules.");
      });
    }

    // Render players without checkbox or delete button
    function renderPlayers() {
      const ul = document.getElementById('all-players');
      const dropdown = document.getElementById('delete-players-dropdown');
      dropdown.innerHTML = '<option value="" disabled>Select players to delete</option>';
      db.collection("players").orderBy("name").onSnapshot(snapshot => {
        ul.innerHTML = '';
        let i = 1;
        snapshot.forEach(doc => {
          const data = doc.data();
          const li = document.createElement('li');
          li.className = 'player-item';
          li.setAttribute('data-id', doc.id);
          li.innerHTML = `${i++}. ${data.name}`;
          ul.appendChild(li);
          const option = document.createElement('option');
          option.value = doc.id;
          option.textContent = data.name;
          dropdown.appendChild(option);
        });
      });
    }

    function addNewPlayer() {
      const newName = prompt("Enter new player's name:");
      if (newName) db.collection("players").add({ name: newName.trim().toUpperCase() });
    }

    function showDeleteModal() {
      const dropdown = document.getElementById('delete-players-dropdown');
      const selectedIds = Array.from(dropdown.selectedOptions).map(option => option.value);
      if (selectedIds.length === 0) {
        alert("No players selected.");
        return;
      }
      const modal = document.getElementById('delete-modal');
      const message = document.getElementById('modal-message');
      message.textContent = `Are you sure you want to delete ${selectedIds.length} selected player(s)?`;
      modal.style.display = 'flex';
      document.getElementById('confirm-delete').onclick = () => deleteSelectedPlayers(selectedIds);
    }

    function deleteSelectedPlayers(selectedIds) {
      const ul = document.getElementById('all-players');
      selectedIds.forEach(id => {
        const li = ul.querySelector(`.player-item[data-id="${id}"]`);
        if (li) li.classList.add('deleting');
      });
      setTimeout(() => {
        const batch = db.batch();
        selectedIds.forEach(id => {
          batch.delete(db.collection("players").doc(id));
        });
        batch.commit().then(() => {
          closeModal();
          renderPlayers();
        });
      }, 500);
    }

    function showResetModal() {
      const modal = document.getElementById('delete-modal');
      const message = document.getElementById('modal-message');
      message.textContent = 'Are you sure you want to reset all players?';
      modal.style.display = 'flex';
      document.getElementById('confirm-delete').onclick = () => resetPlayers();
    }

    function resetPlayers() {
      const ul = document.getElementById('all-players');
      ul.querySelectorAll('.player-item').forEach(li => li.classList.add('deleting'));
      setTimeout(() => {
        db.collection("players").get().then(snapshot => {
          const batch = db.batch();
          snapshot.forEach(doc => batch.delete(doc.ref));
          batch.commit().then(() => {
            closeModal();
            renderPlayers();
          });
        });
      }, 500);
    }

    function closeModal() {
      document.getElementById('delete-modal').style.display = 'none';
    }

    // Contributions
    function addContribution(event) {
      event.preventDefault();
      const name = document.getElementById('contribName').value.trim().toUpperCase();
      const amount = parseInt(document.getElementById('contribAmount').value);
      if (!name || isNaN(amount) || amount < 1) return;
      const contribDoc = db.collection("contributions").doc(name);
      contribDoc.get().then(docSnapshot => {
        if (docSnapshot.exists) {
          const data = docSnapshot.data();
          contribDoc.update({
            contrib: (data.contrib || 0) + amount,
            total: (data.total || 0) + amount,
            paid: true,
            paidAmount: amount
          });
        } else {
          contribDoc.set({
            name,
            contrib: amount,
            total: amount,
            paid: true,
            paidAmount: amount
          });
        }
        document.getElementById('contribName').value = '';
        document.getElementById('contribAmount').value = '';
      }).catch(err => {
        console.error("Contribution failed:", err);
        alert("Error saving to Firestore. Check your rules.");
      });
    }

    function renderContributions() {
      const tbody = document.getElementById('contrib-body');
      db.collection("contributions").orderBy("name").onSnapshot(snapshot => {
        let totalContrib = 0;
        let totalAll = 0;
        tbody.innerHTML = '';
        let index = 1;
        snapshot.forEach(doc => {
          const c = doc.data();
          totalContrib += c.contrib || 0;
          totalAll += c.total || 0;
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${index++}</td>
            <td>${c.name}</td>
            <td>${c.contrib || 0}</td>
            <td>${c.total || 0}</td>
            <td class="${c.paid ? 'paid' : ''}">${c.paid ? '✅' : 'No'}</td>
          `;
          tbody.appendChild(tr);
        });
        document.getElementById('total-contrib').textContent = totalContrib;
        document.getElementById('total-all').textContent = totalAll;
      });
    }

    function resetContributions() {
      if (confirm("Are you sure you want to reset all contributions?")) {
        db.collection("contributions").get().then(snapshot => {
          const batch = db.batch();
          snapshot.forEach(doc => batch.delete(doc.ref));
          batch.commit().then(renderContributions);
        });
      }
    }

    function copyNumber() {
      const number = document.getElementById('payNumber').textContent;
      navigator.clipboard.writeText(number).then(() => {
        alert("Number copied: " + number);
      });
    }

    function joinWhatsApp() {
      window.open('https://chat.whatsapp.com/Foof1HTeEWBBJJCU6nSVEM', '_blank');
    }

    document.getElementById('edit-pic').addEventListener('click', () => {
      alert("Feature to upload/change profile picture coming soon!");
    });

    // Dynamic year for footer
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
</body>
</html>
